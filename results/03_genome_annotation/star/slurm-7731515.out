#!/bin/bash -l
#SBATCH -A uppmax2023-2-8 -M snowy # Specifying the project ID for Genome Analysis
#SBATCH -p core
#SBATCH -n 8
#SBATCH -t 00:15:00 --qos=short # Should be about 30 minute job?
#SBATCH -J Star_durian # Job_name
#SBATCH --mail-type=ALL
#SBATCH --mail-user jonathan.edwall.4996@student.uu.se

cat $0
echo USER = $USER
echo QOS = $SLURM_JOB_QOS


export $HOME/joed4996/Genome_analysis_local_rep/results/03_genome_annotation/star

trimmed_cDNA_dir=$HOME/Genome_analysis_local_rep/results/01_preprocessing/trimmomatic_star
masked_assembly_dir=$HOME/Genome_analysis_local_rep/results/03_genome_annotation/repeatmasker
genome_index_dir=$HOME/Genome_analysis_local_rep/results/03_genome_annotation/star_01_genome_index_dir

# Loading the modules
module load bioinfo-tools star



# Generating genome index
STAR \
--genomeFastaFiles $masked_assembly_dir/pilon_assembly_improvement.fasta.masked \
--genomeDir $genome_index_dir \
--runMode genomeGenerate


# Mapping RNA to assembly
STAR \
--runThreadN 8 \
--genomeDir $genome_index_dir/ \
--readFilesIn $trimmed_cDNA_dir/illumina_cDNA_trimmed_*P.fq.gz \
--readFilesCommand zcat \
--outSAMtype BAM Unsorted SortedByCoordinate 




ls -l # Checking if outputs was generated

module list # Useful for keeping track of the versions used
echo JOB = $SLURM_JOBID # makes the individual runs easier to identify
USER = joed4996
QOS = short
/var/spool/slurmd/job7731515/slurm_script: line 15: export: `/home/joed4996/joed4996/Genome_analysis_local_rep/results/03_genome_annotation/star': not a valid identifier
	STAR --genomeFastaFiles /home/joed4996/Genome_analysis_local_rep/results/03_genome_annotation/repeatmasker/pilon_assembly_improvement.fasta.masked --genomeDir /home/joed4996/Genome_analysis_local_rep/results/03_genome_annotation/star_01_genome_index_dir --runMode genomeGenerate
	STAR version: 2.7.9a   compiled: 2021-10-20T18:01:41+0200 rackham5.uppmax.uu.se:/sw/bioinfo/star/2.7.9a/src/STAR-2.7.9a/source
Apr 25 15:11:19 ..... started STAR run
Apr 25 15:11:19 ... starting to generate Genome files
!!!!! WARNING: --genomeSAindexNbases 14 is too large for the genome size=26279748, which may cause seg-fault at the mapping step. Re-run genome generation with recommended --genomeSAindexNbases 11
Apr 25 15:11:21 ... starting to sort Suffix Array. This may take a long time...
Apr 25 15:11:21 ... sorting Suffix Array chunks and saving them to disk...
Apr 25 15:11:56 ... loading chunks from disk, packing SA...
Apr 25 15:11:58 ... finished generating suffix array
Apr 25 15:11:58 ... generating Suffix Array index
Apr 25 15:12:09 ... completed Suffix Array index
Apr 25 15:12:09 ... writing Genome to disk ...
Apr 25 15:12:11 ... writing Suffix Array to disk ...
Apr 25 15:12:13 ... writing SAindex to disk
Apr 25 15:12:30 ..... finished successfully
	STAR --runThreadN 8 --genomeDir /home/joed4996/Genome_analysis_local_rep/results/03_genome_annotation/star_01_genome_index_dir/ --readFilesIn /home/joed4996/Genome_analysis_local_rep/results/01_preprocessing/trimmomatic_star/illumina_cDNA_trimmed_1P.fq.gz /home/joed4996/Genome_analysis_local_rep/results/01_preprocessing/trimmomatic_star/illumina_cDNA_trimmed_2P.fq.gz --readFilesCommand zcat --outSAMtype BAM Unsorted SortedByCoordinate
	STAR version: 2.7.9a   compiled: 2021-10-20T18:01:41+0200 rackham5.uppmax.uu.se:/sw/bioinfo/star/2.7.9a/src/STAR-2.7.9a/source
Apr 25 15:12:30 ..... started STAR run
Apr 25 15:12:30 ..... loading genome
Apr 25 15:12:31 ..... started mapping
Apr 25 15:16:04 ..... finished mapping
Apr 25 15:16:05 ..... started sorting BAM
Apr 25 15:17:08 ..... finished successfully
total 3656112
-rw-rw-r-- 1 joed4996 joed4996 2049870856 Apr 25 15:16 Aligned.out.bam
-rw-rw-r-- 1 joed4996 joed4996 1678443825 Apr 25 15:17 Aligned.sortedByCoord.out.bam
-rw-rw-r-- 1 joed4996 joed4996       2011 Apr 25 15:17 Log.final.out
-rw-rw-r-- 1 joed4996 joed4996      32920 Apr 25 15:17 Log.out
-rw-rw-r-- 1 joed4996 joed4996        718 Apr 25 15:17 Log.progress.out
-rw-rw-r-- 1 joed4996 joed4996     784931 Apr 25 15:16 SJ.out.tab
-rw-rw-r-- 1 joed4996 joed4996       3617 Apr 25 15:17 slurm-7731515.out
drwx--S--- 3 joed4996 joed4996       4096 Apr 25 15:17 _STARtmp

Currently Loaded Modules:
  1) bioinfo-tools   2) star/2.7.9a

 

JOB = 7731515
